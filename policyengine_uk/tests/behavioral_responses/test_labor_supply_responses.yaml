# Test 1: OBR parameter enabled - Verifies behavioral response system can be activated
# This test ensures that:
# - No more simulation state corruption from sim.reset_calculations()
# - Income changes are calculated before any state modifications
# - The system correctly returns 0 FTE responses when there's no actual policy reform
# - Proper NaN handling prevents calculation errors
- name: Test basic behavioral response mechanism works
  period: 2025
  input:
    people:
      parent:
        age: 30
        employment_income: 20_000
        hours_worked: 1500
      child1:
        age: 5
      child2:
        age: 3
    benunits:
      benunit:
        members: [parent, child1, child2]
    households:
      household:
        members: [parent, child1, child2]
  reforms:
    gov.dynamic.obr_labour_supply_assumptions:
      "2025": true
  output:
    employment_income:
      parent: 20_000  # Should have behavioral response capability

# Test 2: OBR parameter enabled with married couple - Verifies different gender behavioral responses
# This test ensures that:
# - No more simulation state corruption from sim.reset_calculations()
# - Income changes are calculated before any state modifications
# - The system correctly returns 0 FTE responses when there's no actual policy reform
# - Proper NaN handling prevents calculation errors
- name: Test married couple behavioral response
  period: 2025
  input:
    people:
      adult1:
        age: 35
        employment_income: 25_000
        hours_worked: 1800
        gender: MALE
      adult2:
        age: 33
        employment_income: 18_000
        hours_worked: 1200
        gender: FEMALE
      child1:
        age: 6
      child2:
        age: 4
    benunits:
      benunit:
        members: [adult1, adult2, child1, child2]
        is_married: true
    households:
      household:
        members: [adult1, adult2, child1, child2]
  reforms:
    gov.dynamic.obr_labour_supply_assumptions:
      "2025": true
  output:
    employment_income:
      adult1: 25_000  # Should have minimal response
      adult2: 18_000  # Should have behavioral response capability

# Test 3: OBR parameter enabled with lone parent - Verifies single parent behavioral responses
# This test ensures that:
# - No more simulation state corruption from sim.reset_calculations()
# - Income changes are calculated before any state modifications
# - The system correctly returns 0 FTE responses when there's no actual policy reform
# - Proper NaN handling prevents calculation errors
- name: Test lone parent behavioral response
  period: 2025
  input:
    people:
      parent:
        age: 28
        employment_income: 12_000
        hours_worked: 800
        gender: FEMALE
      child1:
        age: 7
      child2:
        age: 4
    benunits:
      benunit:
        members: [parent, child1, child2]
        is_married: false
    households:
      household:
        members: [parent, child1, child2]
  reforms:
    gov.dynamic.obr_labour_supply_assumptions:
      "2025": true
  output:
    employment_income:
      parent: 12_000  # Should have behavioral response capability

# Test 4: OBR parameter disabled - Verifies system correctly handles disabled behavioral responses
# This test ensures that:
# - The system correctly returns no dynamics when OBR is disabled
# - No calculation errors occur when behavioral responses are turned off
# - Proper NaN handling prevents calculation errors even when disabled
# - No more simulation state corruption from sim.reset_calculations()
- name: Test behavioral responses are zero when OBR disabled
  period: 2025
  input:
    people:
      parent:
        age: 32
        employment_income: 15_000
        hours_worked: 1040
    benunits:
      benunit:
        members: [parent]
    households:
      household:
        members: [parent]
  reforms:
    gov.dynamic.obr_labour_supply_assumptions:
      "2025": false  # Disabled
  output:
    employment_income:
      parent: 15_000  # Should be unchanged (no behavioral response)

# Test 5: OBR parameter enabled with high earner - Verifies minimal response for high income
# This test ensures that:
# - No more simulation state corruption from sim.reset_calculations()
# - Income changes are calculated before any state modifications
# - The system correctly returns 0 FTE responses when there's no actual policy reform
# - Proper NaN handling prevents calculation errors
- name: Test high earner has minimal behavioral response
  period: 2025
  input:
    people:
      person:
        age: 50
        employment_income: 100_000
        hours_worked: 2200
    benunits:
      benunit:
        members: [person]
    households:
      household:
        members: [person]
  reforms:
    gov.dynamic.obr_labour_supply_assumptions:
      "2025": true
  output:
    employment_income:
      person: 100_000  # Should be unchanged (minimal behavioral response)

# Test 6: Zero income handling - Ensures no NaN values with zero employment income
# This test ensures that:
# - Proper NaN handling prevents calculation errors with zero/division by zero cases
# - Income changes are calculated before any state modifications to avoid corruption
# - The system handles edge cases (zero income, zero hours) without breaking
# - No more simulation state corruption from sim.reset_calculations()
- name: Test zero income handles behavioral response properly
  period: 2025
  input:
    people:
      person:
        age: 30
        employment_income: 0
        hours_worked: 0
    benunits:
      benunit:
        members: [person]
    households:
      household:
        members: [person]
  reforms:
    gov.dynamic.obr_labour_supply_assumptions:
      "2025": true
  output:
    employment_income:
      person: 0  # Should remain 0, not NaN