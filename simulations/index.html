<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Running simulations - PolicyEngine UK documentation</title><meta property="og:title" content="Running simulations - PolicyEngine UK documentation"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/build/_assets/app-5WKS5EPQ.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><div class="p-1 mr-3 dark:bg-white dark:rounded"><img src="/build/logo-2bd7d2ab9c2d9ac8ba7bbafb653bd229.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R74op:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">âŒ˜</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="PolicyEngine UK documentation" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/">PolicyEngine UK documentation</a><div data-state="open" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Usage" class="block break-words rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 cursor-pointer">Usage</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmp8p:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:Rmp8p:" class="pl-3 pr-[2px] collapsible-content"><a title="Getting started" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/getting-started">Getting started</a><a title="Running simulations" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg bg-blue-300/30 active" href="/simulations">Running simulations</a><a title="Creating policy scenarios" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/scenarios">Creating policy scenarios</a></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Assumptions" class="block break-words rounded py-2 grow cursor-pointer">Assumptions</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rup8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rup8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Validation" class="block break-words rounded py-2 grow cursor-pointer">Validation</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16p8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16p8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Policy" class="block break-words rounded py-2 grow cursor-pointer">Policy</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1ep8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1ep8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/policyengine/policyengine-uk" title="GitHub Repository: policyengine/policyengine-uk" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><a href="https://github.com/policyengine/policyengine-uk/blob/master/docs/book/usage/simulations.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8top:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Running simulations</h1><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78top:" data-state="closed">PolicyEngine</button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><p>The <code>Simulation</code> class is the heart of PolicyEngine UK - it calculates tax and benefit outcomes for people and households. This guide walks you through everything from basic calculations to advanced microsimulation analysis.</p><h2 id="creating-your-first-simulation" class="relative group"><span class="heading-text">Creating your first simulation</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#creating-your-first-simulation" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>Every simulation starts with a situation that describes the people, benefit units, and households you want to analyse:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from policyengine_uk import Simulation

situation = {
    &quot;people&quot;: {
        &quot;person_1&quot;: {
            &quot;age&quot;: {2025: 30},
            &quot;employment_income&quot;: {2025: 30_000}
        }
    },
    &quot;benunits&quot;: {
        &quot;benunit_1&quot;: {
            &quot;members&quot;: [&quot;person_1&quot;]
        }
    },
    &quot;households&quot;: {
        &quot;household_1&quot;: {
            &quot;members&quot;: [&quot;person_1&quot;]
        }
    }
}

sim = Simulation(situation=situation)
income_tax = sim.calculate(&quot;income_tax&quot;, 2025)
print(f&quot;Income tax: Â£{income_tax[0]:.2f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>This creates a simulation for one person and calculates their annual income tax liability. The result shows they would pay Â£3,486 per year in income tax.</p><h2 id="understanding-the-situation-structure" class="relative group"><span class="heading-text">Understanding the situation structure</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#understanding-the-situation-structure" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>The situation dictionary has three main sections:</p><p><strong>People</strong> define individuals with their characteristics:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">&quot;people&quot;: {
    &quot;sarah&quot;: {
        &quot;age&quot;: {2025: 28},
        &quot;employment_income&quot;: {2025: 35_000},
        &quot;pension_contributions&quot;: {2025: 2_800}
    },
    &quot;tom&quot;: {
        &quot;age&quot;: {2025: 32},
        &quot;self_employment_income&quot;: {2025: 18_000}
    }
}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p><strong>Benefit units</strong> group people for benefit calculations (typically families):</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">&quot;benunits&quot;: {
    &quot;family&quot;: {
        &quot;members&quot;: [&quot;sarah&quot;, &quot;tom&quot;]
    }
}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p><strong>Households</strong> group people who live together:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">&quot;households&quot;: {
    &quot;home&quot;: {
        &quot;members&quot;: [&quot;sarah&quot;, &quot;tom&quot;],
        &quot;housing_costs&quot;: {2025: 11400},  # Annual rent
        &quot;council_tax&quot;: {2025: 1_800}   # Annual
    }
}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="calculating-different-variables" class="relative group"><span class="heading-text">Calculating different variables</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#calculating-different-variables" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>PolicyEngine UK can calculate hundreds of variables. Here are some common ones:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Taxes
income_tax = sim.calculate(&quot;income_tax&quot;, 2025)
national_insurance = sim.calculate(&quot;national_insurance&quot;, 2025)
council_tax = sim.calculate(&quot;council_tax&quot;, 2025)

# Benefits
universal_credit = sim.calculate(&quot;universal_credit&quot;, 2025)
child_benefit = sim.calculate(&quot;child_benefit&quot;, 2025)
state_pension = sim.calculate(&quot;state_pension&quot;, 2025)

# Summary measures
net_income = sim.calculate(&quot;household_net_income&quot;, 2025)
in_poverty = sim.calculate(&quot;in_poverty&quot;, 2025)
marginal_tax_rate = sim.calculate(&quot;marginal_tax_rate&quot;, 2025)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>These calculations return arrays because simulations can handle multiple people, benefit units or households simultaneously. Each variable gives you results at the appropriate level - income tax is calculated per person, Universal Credit per benefit unit, and council tax per household.</p><h2 id="simulating-policy-scenarios" class="relative group"><span class="heading-text">Simulating policy scenarios</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#simulating-policy-scenarios" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>To test policy changes, create a scenario and apply it to your simulation. This example shows what happens when we increase Universal Creditâ€™s standard allowance for single people over 25 from the current rate to Â£500 per month:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from policyengine_uk import Scenario

# Create a scenario that increases UC standard allowance
scenario = Scenario(parameter_changes={
    &quot;gov.dwp.universal_credit.standard_allowance.single.OVER_25&quot;: 500
})

# Apply the scenario to create a new simulation
reformed_sim = Simulation(situation=situation, scenario=scenario)

# Compare the average UC payment between baseline and scenario
baseline_uc = sim.calculate(&quot;universal_credit&quot;, 2025).mean()
reformed_uc = reformed_sim.calculate(&quot;universal_credit&quot;, 2025).mean()

# Calculate the difference to see the policy impact
difference = reformed_uc - baseline_uc
print(f&quot;Average UC increase: Â£{difference:.2f} per month&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="working-with-families-and-children" class="relative group"><span class="heading-text">Working with families and children</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#working-with-families-and-children" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>Family situations require more detailed setup:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">family_with_children = {
    &quot;people&quot;: {
        &quot;parent&quot;: {
            &quot;age&quot;: {2025: 35},
            &quot;employment_income&quot;: {2025: 28_000}
        },
        &quot;partner&quot;: {
            &quot;age&quot;: {2025: 33},
            &quot;employment_income&quot;: {2025: 12_000}
        },
        &quot;child_1&quot;: {
            &quot;age&quot;: {2025: 7}
        },
        &quot;child_2&quot;: {
            &quot;age&quot;: {2025: 4}
        }
    },
    &quot;benunits&quot;: {
        &quot;family&quot;: {
            &quot;members&quot;: [&quot;parent&quot;, &quot;partner&quot;, &quot;child_1&quot;, &quot;child_2&quot;]
        }
    },
    &quot;households&quot;: {
        &quot;home&quot;: {
            &quot;members&quot;: [&quot;parent&quot;, &quot;partner&quot;, &quot;child_1&quot;, &quot;child_2&quot;],
            &quot;housing_costs&quot;: {2025: 9600},  # Annual housing costs
            &quot;childcare_costs&quot;: {2025: 7200}  # Annual childcare costs
        }
    }
}

family_sim = Simulation(situation=family_with_children)

# Calculate family-specific benefits - these are per benefit unit (family)
child_benefit = family_sim.calculate(&quot;child_benefit&quot;, 2025).mean()
childcare_support = family_sim.calculate(&quot;universal_credit_childcare&quot;, 2025).mean()

print(f&quot;Child benefit: Â£{child_benefit:.2f} per month&quot;)
print(f&quot;Childcare support: Â£{childcare_support:.2f} per month&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="using-different-data-sources" class="relative group"><span class="heading-text">Using different data sources</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#using-different-data-sources" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><h3 id="from-pandas-dataframes" class="relative group"><span class="heading-text">From pandas DataFrames</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#from-pandas-dataframes" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>If you have data in a DataFrame, convert it to the right format:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pandas as pd

# Your data needs specific column naming
df = pd.DataFrame({
    &quot;person_id__2025&quot;: [1, 2, 3],
    &quot;age__2025&quot;: [25, 45, 65],
    &quot;employment_income__2025&quot;: [20000, 40000, 0],
    &quot;state_pension__2025&quot;: [0, 0, 180]  # Weekly pension
})

# Create simulation from the DataFrame
sim_from_df = Simulation(dataset=df)
# Calculate total income tax across all people in the dataset
total_tax = sim_from_df.calculate(&quot;income_tax&quot;, 2025).sum()
print(f&quot;Total income tax from all people: Â£{total_tax:.2f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>The column naming follows the pattern <code>variable_name__year</code> for time-varying variables.</p><h3 id="from-survey-datasets" class="relative group"><span class="heading-text">From survey datasets</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#from-survey-datasets" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>For population-level analysis, use survey data:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from policyengine_uk import Microsimulation

# Load the Enhanced Family Resources Survey
sim = Microsimulation(
    dataset=&quot;hf://policyengine/policyengine-uk-data/enhanced_frs_2022_23.h5&quot;
)

# Calculate population totals using survey weights
# This gives us an estimate for the entire UK population
total_income_tax = sim.calculate(&quot;income_tax&quot;, 2025).sum() / 1e9
print(f&quot;Total UK income tax revenue: Â£{total_income_tax:.1f}bn&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="microsimulation-analysis" class="relative group"><span class="heading-text">Microsimulation analysis</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#microsimulation-analysis" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>The <code>Microsimulation</code> class extends <code>Simulation</code> with survey weights for population estimates:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from policyengine_uk import Microsimulation

# Compare baseline and reform
baseline = Microsimulation(
    dataset=&quot;hf://policyengine/policyengine-uk-data/enhanced_frs_2022_23.h5&quot;
)

# Create a scenario that increases the basic rate of income tax to 25%
scenario = Scenario(parameter_changes={
    &quot;gov.hmrc.income_tax.rates.uk[0].rate&quot;: 0.25
})
reformed = Microsimulation(
    dataset=&quot;hf://policyengine/policyengine-uk-data/enhanced_frs_2022_23.h5&quot;,
    scenario=scenario
)

# Calculate revenue impact by comparing household net incomes
# When net income falls, government revenue increases
baseline_net = baseline.calculate(&quot;household_net_income&quot;, 2025)
reformed_net = reformed.calculate(&quot;household_net_income&quot;, 2025)

# The negative of the income change gives us the revenue change
revenue_change = -(reformed_net - baseline_net).sum() / 1e9
print(f&quot;Additional government revenue: Â£{revenue_change:.1f}bn&quot;)

# Analyse distributional impact by looking at poverty rates
# in_poverty is a boolean variable, so mean() gives us the poverty rate
poverty_baseline = baseline.calculate(&quot;in_poverty&quot;, 2025).mean()
poverty_reformed = reformed.calculate(&quot;in_poverty&quot;, 2025).mean()

poverty_change = poverty_reformed - poverty_baseline
print(f&quot;Poverty rate change: {poverty_change:.1%}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="advanced-techniques" class="relative group"><span class="heading-text">Advanced techniques</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#advanced-techniques" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><h3 id="calculating-multiple-variables-efficiently" class="relative group"><span class="heading-text">Calculating multiple variables efficiently</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#calculating-multiple-variables-efficiently" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>Instead of calculating variables one by one, you can get multiple results at once using the built-in <code>calculate_dataframe</code> method:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Get multiple variables in a single DataFrame
variables = [&quot;employment_income&quot;, &quot;income_tax&quot;, &quot;universal_credit&quot;, &quot;household_net_income&quot;]
results_df = sim.calculate_dataframe(variables, 2025)

# This gives you a DataFrame with columns for each variable
print(results_df.head())
print(f&quot;Average net income: Â£{results_df[&#x27;household_net_income&#x27;].mean():.2f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="working-with-different-time-periods" class="relative group"><span class="heading-text">Working with different time periods</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#working-with-different-time-periods" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Multi-year analysis to see how income changes over time
years = [2023, 2024, 2025]
income_by_year = {}

for year in years:
    income_by_year[year] = sim.calculate(&quot;household_net_income&quot;, year)

# Compare average household income across years
for year in years:
    avg_income = income_by_year[year].mean()
    print(f&quot;{year}: Â£{avg_income/12:.2f} per month&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="mapping-variables-to-different-entities" class="relative group"><span class="heading-text">Mapping variables to different entities</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mapping-variables-to-different-entities" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>Some variables can be calculated at different levels:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Calculate employment income at different entity levels
# Individual level - one value per person
person_income = sim.calculate(&quot;employment_income&quot;, 2025)
print(f&quot;Average personal employment income: Â£{person_income.mean():.2f}&quot;)

# Household level - sums all employment income within each household
household_income = sim.calculate(&quot;employment_income&quot;, 2025, map_to=&quot;household&quot;)
print(f&quot;Average household employment income: Â£{household_income.mean():.2f}&quot;)

# Benefit unit level - sums employment income within each benefit unit (family)
benunit_income = sim.calculate(&quot;employment_income&quot;, 2025, map_to=&quot;benunit&quot;)
print(f&quot;Average benefit unit employment income: Â£{benunit_income.mean():.2f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="using-custom-weights" class="relative group"><span class="heading-text">Using custom weights</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#using-custom-weights" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>For microsimulation with custom weights:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Access and modify survey weights for sensitivity analysis
weights = sim.get_weights(&quot;income_tax&quot;, 2025)
modified_weights = weights * 1.1  # Increase all weights by 10%

# Calculate population total with modified weights
unweighted_values = sim.calculate(&quot;income_tax&quot;, 2025, use_weights=False)
weighted_total = (unweighted_values * modified_weights).sum()
print(f&quot;Total with 10% higher weights: Â£{weighted_total/1e9:.1f}bn&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="debugging-simulations" class="relative group"><span class="heading-text">Debugging simulations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#debugging-simulations" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>When simulations donâ€™t behave as expected:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Check individual components to understand the tax calculation
# These help you trace through how income tax is calculated step by step
employment_income = sim.calculate(&quot;employment_income&quot;, 2025).mean()
personal_allowance = sim.calculate(&quot;personal_allowance&quot;, 2025).mean()
taxable_income = sim.calculate(&quot;adjusted_net_income&quot;, 2025).mean()
income_tax = sim.calculate(&quot;income_tax&quot;, 2025).mean()

print(f&quot;Employment income: Â£{employment_income:.2f}&quot;)
print(f&quot;Personal allowance: Â£{personal_allowance:.2f}&quot;)
print(f&quot;Taxable income: Â£{taxable_income:.2f}&quot;)
print(f&quot;Income tax: Â£{income_tax:.2f}&quot;)

# Verify the household composition was interpreted correctly
avg_age = sim.calculate(&quot;age&quot;, 2025).mean()
children_per_household = sim.calculate(&quot;household_count_children&quot;, 2025).mean()
print(f&quot;Average age: {avg_age:.1f} years&quot;)
print(f&quot;Average children per household: {children_per_household:.1f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="performance-tips" class="relative group"><span class="heading-text">Performance tips</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#performance-tips" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><ul><li>Use <code>Microsimulation</code> for population analysis, <code>Simulation</code> for household-level work</li><li>Calculate multiple variables in batches rather than individually</li><li>For large datasets, consider calculating subsets first to verify your logic</li><li>Cache simulation results when running the same calculation multiple times</li></ul><p>The simulation system is designed to be flexible and powerful. Start with simple examples and gradually build up to more complex analyses as you become familiar with the structure and capabilities.</p><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/getting-started"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">Usage</div>Getting started</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/scenarios"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">Usage</div>Creating policy scenarios</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/build/_shared/chunk-JSE36H2O.js"/><link rel="modulepreload" href="/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-C7FW3E47.js"/><link rel="modulepreload" href="/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/build/_shared/chunk-ND43KHSX.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-IB5726YR.js"/><link rel="modulepreload" href="/build/_shared/chunk-NBON2RSI.js"/><link rel="modulepreload" href="/build/routes/$-LXLHKVOR.js"/><script>window.__remixContext = {"url":"/simulations","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.0","options":{"logo":"/build/logo-2bd7d2ab9c2d9ac8ba7bbafb653bd229.png"},"nav":[],"actions":[],"projects":[{"title":"PolicyEngine UK documentation","authors":[{"nameParsed":{"literal":"PolicyEngine","family":"PolicyEngine"},"name":"PolicyEngine","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-uk","copyright":"2024","toc":[{"file":"index"},{"children":[{"file":"usage/getting-started"},{"file":"usage/simulations"},{"file":"usage/scenarios"}],"title":"Usage"},{"children":[{"file":"assumptions/growthfactors"},{"file":"assumptions/water-bills"}],"title":"Assumptions"},{"children":[{"file":"validation/hbai"}],"title":"Validation"},{"children":[{"file":"policy/model-baseline"},{"file":"policy/uc-rebalancing"}],"title":"Policy"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Usage"},{"slug":"getting-started","title":"Getting started","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"simulations","title":"Running simulations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scenarios","title":"Creating policy scenarios","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Assumptions"},{"slug":"growthfactors","title":"Economic assumptions","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"water-bills","title":"Water bills projection and uprating","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Validation"},{"slug":"hbai","title":"HBAI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Policy"},{"slug":"model-baseline","title":"Model baseline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"uc-rebalancing","title":"Universal Credit rebalancing reforms","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static"},"routes/$":{"config":{"version":2,"myst":"1.6.0","options":{"logo":"/build/logo-2bd7d2ab9c2d9ac8ba7bbafb653bd229.png"},"nav":[],"actions":[],"projects":[{"title":"PolicyEngine UK documentation","authors":[{"nameParsed":{"literal":"PolicyEngine","family":"PolicyEngine"},"name":"PolicyEngine","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-uk","copyright":"2024","toc":[{"file":"index"},{"children":[{"file":"usage/getting-started"},{"file":"usage/simulations"},{"file":"usage/scenarios"}],"title":"Usage"},{"children":[{"file":"assumptions/growthfactors"},{"file":"assumptions/water-bills"}],"title":"Assumptions"},{"children":[{"file":"validation/hbai"}],"title":"Validation"},{"children":[{"file":"policy/model-baseline"},{"file":"policy/uc-rebalancing"}],"title":"Policy"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Usage"},{"slug":"getting-started","title":"Getting started","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"simulations","title":"Running simulations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scenarios","title":"Creating policy scenarios","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Assumptions"},{"slug":"growthfactors","title":"Economic assumptions","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"water-bills","title":"Water bills projection and uprating","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Validation"},{"slug":"hbai","title":"HBAI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Policy"},{"slug":"model-baseline","title":"Model baseline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"uc-rebalancing","title":"Universal Credit rebalancing reforms","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":2,"kind":"Article","sha256":"0cfc7b2ff6c2a6c41c4bdb734b072fe661d33a1702b969a2e6ead00f950037dc","slug":"simulations","location":"/usage/simulations.md","dependencies":[],"frontmatter":{"title":"Running simulations","content_includes_title":false,"authors":[{"nameParsed":{"literal":"PolicyEngine","family":"PolicyEngine"},"name":"PolicyEngine","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-uk","copyright":"2024","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/policyengine/policyengine-uk/blob/master/docs/book/usage/simulations.md","exports":[{"format":"md","filename":"simulations.md","url":"/build/simulations-d6422501f0c99dedbc30a0b32edfccec.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"glzUjVFQ4s"},{"type":"inlineCode","value":"Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f5AYgCGqqI"},{"type":"text","value":" class is the heart of PolicyEngine UK - it calculates tax and benefit outcomes for people and households. This guide walks you through everything from basic calculations to advanced microsimulation analysis.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a5EUTEs92v"}],"key":"eGHtpML2Td"},{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Creating your first simulation","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bJcHB7ZxiR"}],"identifier":"creating-your-first-simulation","label":"Creating your first simulation","html_id":"creating-your-first-simulation","implicit":true,"key":"Adfxhij57p"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Every simulation starts with a situation that describes the people, benefit units, and households you want to analyse:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hJtUNRYv6X"}],"key":"lDD3QfL6zb"},{"type":"code","lang":"python","value":"from policyengine_uk import Simulation\n\nsituation = {\n    \"people\": {\n        \"person_1\": {\n            \"age\": {2025: 30},\n            \"employment_income\": {2025: 30_000}\n        }\n    },\n    \"benunits\": {\n        \"benunit_1\": {\n            \"members\": [\"person_1\"]\n        }\n    },\n    \"households\": {\n        \"household_1\": {\n            \"members\": [\"person_1\"]\n        }\n    }\n}\n\nsim = Simulation(situation=situation)\nincome_tax = sim.calculate(\"income_tax\", 2025)\nprint(f\"Income tax: Â£{income_tax[0]:.2f}\")","position":{"start":{"line":9,"column":1},"end":{"line":34,"column":1}},"key":"xgRWpXt5ym"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"This creates a simulation for one person and calculates their annual income tax liability. The result shows they would pay Â£3,486 per year in income tax.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"ADa9IrBmu3"}],"key":"lBbA5DF7xj"},{"type":"heading","depth":2,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Understanding the situation structure","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"bt52gIwygU"}],"identifier":"understanding-the-situation-structure","label":"Understanding the situation structure","html_id":"understanding-the-situation-structure","implicit":true,"key":"BxvG7ATS4y"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"The situation dictionary has three main sections:","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"sXLPmsImsy"}],"key":"EKlAKnJEHB"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"strong","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"People","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"ImKQUxqR26"}],"key":"F28GNwEnhV"},{"type":"text","value":" define individuals with their characteristics:","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"cfk8DsYOkw"}],"key":"B6UQI8hLtf"},{"type":"code","lang":"python","value":"\"people\": {\n    \"sarah\": {\n        \"age\": {2025: 28},\n        \"employment_income\": {2025: 35_000},\n        \"pension_contributions\": {2025: 2_800}\n    },\n    \"tom\": {\n        \"age\": {2025: 32},\n        \"self_employment_income\": {2025: 18_000}\n    }\n}","position":{"start":{"line":43,"column":1},"end":{"line":55,"column":1}},"key":"RN5Nq074go"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"strong","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"Benefit units","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"ENfuFLPDT1"}],"key":"AxwVZ6U1ql"},{"type":"text","value":" group people for benefit calculations (typically families):","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"AJcso0VZzl"}],"key":"NNdUhNVQcZ"},{"type":"code","lang":"python","value":"\"benunits\": {\n    \"family\": {\n        \"members\": [\"sarah\", \"tom\"]\n    }\n}","position":{"start":{"line":58,"column":1},"end":{"line":64,"column":1}},"key":"aDlwaHrfoc"},{"type":"paragraph","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"strong","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"Households","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"KjXZ45LnRd"}],"key":"iKjCJ9k2HD"},{"type":"text","value":" group people who live together:","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"BQdzkJBozS"}],"key":"vSWgOoWsl5"},{"type":"code","lang":"python","value":"\"households\": {\n    \"home\": {\n        \"members\": [\"sarah\", \"tom\"],\n        \"housing_costs\": {2025: 11400},  # Annual rent\n        \"council_tax\": {2025: 1_800}   # Annual\n    }\n}","position":{"start":{"line":67,"column":1},"end":{"line":75,"column":1}},"key":"iQjIOXc5WX"},{"type":"heading","depth":2,"position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"Calculating different variables","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"tJoxkEUGz6"}],"identifier":"calculating-different-variables","label":"Calculating different variables","html_id":"calculating-different-variables","implicit":true,"key":"Mp1EtCLP0t"},{"type":"paragraph","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"PolicyEngine UK can calculate hundreds of variables. Here are some common ones:","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"FVJ8ttz6Wq"}],"key":"wEGAOOvp6x"},{"type":"code","lang":"python","value":"# Taxes\nincome_tax = sim.calculate(\"income_tax\", 2025)\nnational_insurance = sim.calculate(\"national_insurance\", 2025)\ncouncil_tax = sim.calculate(\"council_tax\", 2025)\n\n# Benefits\nuniversal_credit = sim.calculate(\"universal_credit\", 2025)\nchild_benefit = sim.calculate(\"child_benefit\", 2025)\nstate_pension = sim.calculate(\"state_pension\", 2025)\n\n# Summary measures\nnet_income = sim.calculate(\"household_net_income\", 2025)\nin_poverty = sim.calculate(\"in_poverty\", 2025)\nmarginal_tax_rate = sim.calculate(\"marginal_tax_rate\", 2025)","position":{"start":{"line":81,"column":1},"end":{"line":96,"column":1}},"key":"GxW44PctEp"},{"type":"paragraph","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"These calculations return arrays because simulations can handle multiple people, benefit units or households simultaneously. Each variable gives you results at the appropriate level - income tax is calculated per person, Universal Credit per benefit unit, and council tax per household.","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"ATUs0Y1TF4"}],"key":"K1o6NA0TAj"},{"type":"heading","depth":2,"position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Simulating policy scenarios","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"h46MwGo7Zy"}],"identifier":"simulating-policy-scenarios","label":"Simulating policy scenarios","html_id":"simulating-policy-scenarios","implicit":true,"key":"tAiYSjsAiX"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"To test policy changes, create a scenario and apply it to your simulation. This example shows what happens when we increase Universal Creditâ€™s standard allowance for single people over 25 from the current rate to Â£500 per month:","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"oWzj1NzzR1"}],"key":"wTXkooOZKz"},{"type":"code","lang":"python","value":"from policyengine_uk import Scenario\n\n# Create a scenario that increases UC standard allowance\nscenario = Scenario(parameter_changes={\n    \"gov.dwp.universal_credit.standard_allowance.single.OVER_25\": 500\n})\n\n# Apply the scenario to create a new simulation\nreformed_sim = Simulation(situation=situation, scenario=scenario)\n\n# Compare the average UC payment between baseline and scenario\nbaseline_uc = sim.calculate(\"universal_credit\", 2025).mean()\nreformed_uc = reformed_sim.calculate(\"universal_credit\", 2025).mean()\n\n# Calculate the difference to see the policy impact\ndifference = reformed_uc - baseline_uc\nprint(f\"Average UC increase: Â£{difference:.2f} per month\")","position":{"start":{"line":104,"column":1},"end":{"line":122,"column":1}},"key":"dO5XpJrPIL"},{"type":"heading","depth":2,"position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"Working with families and children","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"gU6IJvkUTF"}],"identifier":"working-with-families-and-children","label":"Working with families and children","html_id":"working-with-families-and-children","implicit":true,"key":"FaDjVvKUKk"},{"type":"paragraph","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"children":[{"type":"text","value":"Family situations require more detailed setup:","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"yvFX58vFty"}],"key":"qkA1NJ4gG7"},{"type":"code","lang":"python","value":"family_with_children = {\n    \"people\": {\n        \"parent\": {\n            \"age\": {2025: 35},\n            \"employment_income\": {2025: 28_000}\n        },\n        \"partner\": {\n            \"age\": {2025: 33},\n            \"employment_income\": {2025: 12_000}\n        },\n        \"child_1\": {\n            \"age\": {2025: 7}\n        },\n        \"child_2\": {\n            \"age\": {2025: 4}\n        }\n    },\n    \"benunits\": {\n        \"family\": {\n            \"members\": [\"parent\", \"partner\", \"child_1\", \"child_2\"]\n        }\n    },\n    \"households\": {\n        \"home\": {\n            \"members\": [\"parent\", \"partner\", \"child_1\", \"child_2\"],\n            \"housing_costs\": {2025: 9600},  # Annual housing costs\n            \"childcare_costs\": {2025: 7200}  # Annual childcare costs\n        }\n    }\n}\n\nfamily_sim = Simulation(situation=family_with_children)\n\n# Calculate family-specific benefits - these are per benefit unit (family)\nchild_benefit = family_sim.calculate(\"child_benefit\", 2025).mean()\nchildcare_support = family_sim.calculate(\"universal_credit_childcare\", 2025).mean()\n\nprint(f\"Child benefit: Â£{child_benefit:.2f} per month\")\nprint(f\"Childcare support: Â£{childcare_support:.2f} per month\")","position":{"start":{"line":128,"column":1},"end":{"line":168,"column":1}},"key":"O0SzYgBq8X"},{"type":"heading","depth":2,"position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"Using different data sources","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"lbpnj9m12b"}],"identifier":"using-different-data-sources","label":"Using different data sources","html_id":"using-different-data-sources","implicit":true,"key":"bBo0iuIaXD"},{"type":"heading","depth":3,"position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"From pandas DataFrames","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"DU1TOffR6I"}],"identifier":"from-pandas-dataframes","label":"From pandas DataFrames","html_id":"from-pandas-dataframes","implicit":true,"key":"QHHYeOum9l"},{"type":"paragraph","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"If you have data in a DataFrame, convert it to the right format:","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"vAbBv0Hfef"}],"key":"q5RqrhA2to"},{"type":"code","lang":"python","value":"import pandas as pd\n\n# Your data needs specific column naming\ndf = pd.DataFrame({\n    \"person_id__2025\": [1, 2, 3],\n    \"age__2025\": [25, 45, 65],\n    \"employment_income__2025\": [20000, 40000, 0],\n    \"state_pension__2025\": [0, 0, 180]  # Weekly pension\n})\n\n# Create simulation from the DataFrame\nsim_from_df = Simulation(dataset=df)\n# Calculate total income tax across all people in the dataset\ntotal_tax = sim_from_df.calculate(\"income_tax\", 2025).sum()\nprint(f\"Total income tax from all people: Â£{total_tax:.2f}\")","position":{"start":{"line":176,"column":1},"end":{"line":192,"column":1}},"key":"Ns4gwu0AfQ"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"The column naming follows the pattern ","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"iCJC3nYoie"},{"type":"inlineCode","value":"variable_name__year","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"tvQucoGJjm"},{"type":"text","value":" for time-varying variables.","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"MuxuQWoJCo"}],"key":"DRxkoMkMbm"},{"type":"heading","depth":3,"position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"From survey datasets","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"tCzq9EW9jA"}],"identifier":"from-survey-datasets","label":"From survey datasets","html_id":"from-survey-datasets","implicit":true,"key":"OUtoIGXb8T"},{"type":"paragraph","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"For population-level analysis, use survey data:","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"k8wTKFAxyc"}],"key":"porL7AzF41"},{"type":"code","lang":"python","value":"from policyengine_uk import Microsimulation\n\n# Load the Enhanced Family Resources Survey\nsim = Microsimulation(\n    dataset=\"hf://policyengine/policyengine-uk-data/enhanced_frs_2022_23.h5\"\n)\n\n# Calculate population totals using survey weights\n# This gives us an estimate for the entire UK population\ntotal_income_tax = sim.calculate(\"income_tax\", 2025).sum() / 1e9\nprint(f\"Total UK income tax revenue: Â£{total_income_tax:.1f}bn\")","position":{"start":{"line":200,"column":1},"end":{"line":212,"column":1}},"key":"OPOieYwSO7"},{"type":"heading","depth":2,"position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"text","value":"Microsimulation analysis","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"lxlvhGpTzt"}],"identifier":"microsimulation-analysis","label":"Microsimulation analysis","html_id":"microsimulation-analysis","implicit":true,"key":"iZEjBBCSsY"},{"type":"paragraph","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"sj4aWN6ZCb"},{"type":"inlineCode","value":"Microsimulation","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"UAjCt4A3b9"},{"type":"text","value":" class extends ","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"MTVaOZRXoQ"},{"type":"inlineCode","value":"Simulation","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"DDhjL8Q3DH"},{"type":"text","value":" with survey weights for population estimates:","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"tIPbGuKAlR"}],"key":"YQgi4jCJvV"},{"type":"code","lang":"python","value":"from policyengine_uk import Microsimulation\n\n# Compare baseline and reform\nbaseline = Microsimulation(\n    dataset=\"hf://policyengine/policyengine-uk-data/enhanced_frs_2022_23.h5\"\n)\n\n# Create a scenario that increases the basic rate of income tax to 25%\nscenario = Scenario(parameter_changes={\n    \"gov.hmrc.income_tax.rates.uk[0].rate\": 0.25\n})\nreformed = Microsimulation(\n    dataset=\"hf://policyengine/policyengine-uk-data/enhanced_frs_2022_23.h5\",\n    scenario=scenario\n)\n\n# Calculate revenue impact by comparing household net incomes\n# When net income falls, government revenue increases\nbaseline_net = baseline.calculate(\"household_net_income\", 2025)\nreformed_net = reformed.calculate(\"household_net_income\", 2025)\n\n# The negative of the income change gives us the revenue change\nrevenue_change = -(reformed_net - baseline_net).sum() / 1e9\nprint(f\"Additional government revenue: Â£{revenue_change:.1f}bn\")\n\n# Analyse distributional impact by looking at poverty rates\n# in_poverty is a boolean variable, so mean() gives us the poverty rate\npoverty_baseline = baseline.calculate(\"in_poverty\", 2025).mean()\npoverty_reformed = reformed.calculate(\"in_poverty\", 2025).mean()\n\npoverty_change = poverty_reformed - poverty_baseline\nprint(f\"Poverty rate change: {poverty_change:.1%}\")","position":{"start":{"line":218,"column":1},"end":{"line":251,"column":1}},"key":"LKSTa9iIpg"},{"type":"heading","depth":2,"position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"Advanced techniques","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"ZZp0VpzhCH"}],"identifier":"advanced-techniques","label":"Advanced techniques","html_id":"advanced-techniques","implicit":true,"key":"A7h5Az3dD9"},{"type":"heading","depth":3,"position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"Calculating multiple variables efficiently","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"YmsaeSJL3Y"}],"identifier":"calculating-multiple-variables-efficiently","label":"Calculating multiple variables efficiently","html_id":"calculating-multiple-variables-efficiently","implicit":true,"key":"Tg1L4OsSk0"},{"type":"paragraph","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"Instead of calculating variables one by one, you can get multiple results at once using the built-in ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"TD54EFFtqf"},{"type":"inlineCode","value":"calculate_dataframe","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"UjRURoOWiU"},{"type":"text","value":" method:","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"UKPsh2OJPE"}],"key":"NaNPWDw238"},{"type":"code","lang":"python","value":"# Get multiple variables in a single DataFrame\nvariables = [\"employment_income\", \"income_tax\", \"universal_credit\", \"household_net_income\"]\nresults_df = sim.calculate_dataframe(variables, 2025)\n\n# This gives you a DataFrame with columns for each variable\nprint(results_df.head())\nprint(f\"Average net income: Â£{results_df['household_net_income'].mean():.2f}\")","position":{"start":{"line":259,"column":1},"end":{"line":267,"column":1}},"key":"xj1CJbnws5"},{"type":"heading","depth":3,"position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"Working with different time periods","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"key":"DyCOqtOMr5"}],"identifier":"working-with-different-time-periods","label":"Working with different time periods","html_id":"working-with-different-time-periods","implicit":true,"key":"GfMbTixjI4"},{"type":"code","lang":"python","value":"# Multi-year analysis to see how income changes over time\nyears = [2023, 2024, 2025]\nincome_by_year = {}\n\nfor year in years:\n    income_by_year[year] = sim.calculate(\"household_net_income\", year)\n\n# Compare average household income across years\nfor year in years:\n    avg_income = income_by_year[year].mean()\n    print(f\"{year}: Â£{avg_income/12:.2f} per month\")","position":{"start":{"line":271,"column":1},"end":{"line":283,"column":1}},"key":"UFUciXRWkz"},{"type":"heading","depth":3,"position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"children":[{"type":"text","value":"Mapping variables to different entities","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"key":"rfoeA6s8Po"}],"identifier":"mapping-variables-to-different-entities","label":"Mapping variables to different entities","html_id":"mapping-variables-to-different-entities","implicit":true,"key":"pONw53kesU"},{"type":"paragraph","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"Some variables can be calculated at different levels:","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"z1LhYi6JuY"}],"key":"SkYHFvjh2c"},{"type":"code","lang":"python","value":"# Calculate employment income at different entity levels\n# Individual level - one value per person\nperson_income = sim.calculate(\"employment_income\", 2025)\nprint(f\"Average personal employment income: Â£{person_income.mean():.2f}\")\n\n# Household level - sums all employment income within each household\nhousehold_income = sim.calculate(\"employment_income\", 2025, map_to=\"household\")\nprint(f\"Average household employment income: Â£{household_income.mean():.2f}\")\n\n# Benefit unit level - sums employment income within each benefit unit (family)\nbenunit_income = sim.calculate(\"employment_income\", 2025, map_to=\"benunit\")\nprint(f\"Average benefit unit employment income: Â£{benunit_income.mean():.2f}\")","position":{"start":{"line":289,"column":1},"end":{"line":302,"column":1}},"key":"ZJ5KmI3Qk8"},{"type":"heading","depth":3,"position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"children":[{"type":"text","value":"Using custom weights","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"PA8WU2yxY2"}],"identifier":"using-custom-weights","label":"Using custom weights","html_id":"using-custom-weights","implicit":true,"key":"cl8ZAJdYC5"},{"type":"paragraph","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"children":[{"type":"text","value":"For microsimulation with custom weights:","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"LLhx4r3MJ1"}],"key":"vJpPpQI6PA"},{"type":"code","lang":"python","value":"# Access and modify survey weights for sensitivity analysis\nweights = sim.get_weights(\"income_tax\", 2025)\nmodified_weights = weights * 1.1  # Increase all weights by 10%\n\n# Calculate population total with modified weights\nunweighted_values = sim.calculate(\"income_tax\", 2025, use_weights=False)\nweighted_total = (unweighted_values * modified_weights).sum()\nprint(f\"Total with 10% higher weights: Â£{weighted_total/1e9:.1f}bn\")","position":{"start":{"line":308,"column":1},"end":{"line":317,"column":1}},"key":"fj5F8ijS9v"},{"type":"heading","depth":2,"position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"children":[{"type":"text","value":"Debugging simulations","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"key":"JmfJxl9XLv"}],"identifier":"debugging-simulations","label":"Debugging simulations","html_id":"debugging-simulations","implicit":true,"key":"YOpQoUlPBT"},{"type":"paragraph","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"children":[{"type":"text","value":"When simulations donâ€™t behave as expected:","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"key":"r5pfuqzVCa"}],"key":"OkuYBnhFPg"},{"type":"code","lang":"python","value":"# Check individual components to understand the tax calculation\n# These help you trace through how income tax is calculated step by step\nemployment_income = sim.calculate(\"employment_income\", 2025).mean()\npersonal_allowance = sim.calculate(\"personal_allowance\", 2025).mean()\ntaxable_income = sim.calculate(\"adjusted_net_income\", 2025).mean()\nincome_tax = sim.calculate(\"income_tax\", 2025).mean()\n\nprint(f\"Employment income: Â£{employment_income:.2f}\")\nprint(f\"Personal allowance: Â£{personal_allowance:.2f}\")\nprint(f\"Taxable income: Â£{taxable_income:.2f}\")\nprint(f\"Income tax: Â£{income_tax:.2f}\")\n\n# Verify the household composition was interpreted correctly\navg_age = sim.calculate(\"age\", 2025).mean()\nchildren_per_household = sim.calculate(\"household_count_children\", 2025).mean()\nprint(f\"Average age: {avg_age:.1f} years\")\nprint(f\"Average children per household: {children_per_household:.1f}\")","position":{"start":{"line":323,"column":1},"end":{"line":341,"column":1}},"key":"wZgzAtR70R"},{"type":"heading","depth":2,"position":{"start":{"line":343,"column":1},"end":{"line":343,"column":1}},"children":[{"type":"text","value":"Performance tips","position":{"start":{"line":343,"column":1},"end":{"line":343,"column":1}},"key":"WtrYMKQMZQ"}],"identifier":"performance-tips","label":"Performance tips","html_id":"performance-tips","implicit":true,"key":"YV6DkYzym0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":345,"column":1},"end":{"line":349,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"children":[{"type":"text","value":"Use ","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"RroXZdFMXI"},{"type":"inlineCode","value":"Microsimulation","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"yOgGvg3Luo"},{"type":"text","value":" for population analysis, ","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"OfMP7p9swL"},{"type":"inlineCode","value":"Simulation","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"UOcwYjF8Z5"},{"type":"text","value":" for household-level work","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"AEa41VB3d7"}],"key":"XQZfQdNgby"},{"type":"listItem","spread":true,"position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"children":[{"type":"text","value":"Calculate multiple variables in batches rather than individually","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"lauR9gDHRU"}],"key":"jbfcgso7q0"},{"type":"listItem","spread":true,"position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"children":[{"type":"text","value":"For large datasets, consider calculating subsets first to verify your logic","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"aVdW99p4uX"}],"key":"PZDRjcU5ug"},{"type":"listItem","spread":true,"position":{"start":{"line":348,"column":1},"end":{"line":349,"column":1}},"children":[{"type":"text","value":"Cache simulation results when running the same calculation multiple times","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"sizgkfYH2E"}],"key":"pq4quLvniW"}],"key":"tJFoYwlhzT"},{"type":"paragraph","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"children":[{"type":"text","value":"The simulation system is designed to be flexible and powerful. Start with simple examples and gradually build up to more complex analyses as you become familiar with the structure and capabilities.","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"fC9J46368Y"}],"key":"N2loJHjyE7"}],"key":"HODhHkm5uT"}],"key":"Vjd4TDyfB3"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Getting started","url":"/getting-started","group":"Usage"},"next":{"title":"Creating policy scenarios","url":"/scenarios","group":"Usage"}}},"domain":"http://localhost:3000"},"project":{"title":"PolicyEngine UK documentation","authors":[{"nameParsed":{"literal":"PolicyEngine","family":"PolicyEngine"},"name":"PolicyEngine","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-uk","copyright":"2024","toc":[{"file":"index"},{"children":[{"file":"usage/getting-started"},{"file":"usage/simulations"},{"file":"usage/scenarios"}],"title":"Usage"},{"children":[{"file":"assumptions/growthfactors"},{"file":"assumptions/water-bills"}],"title":"Assumptions"},{"children":[{"file":"validation/hbai"}],"title":"Validation"},{"children":[{"file":"policy/model-baseline"},{"file":"policy/uc-rebalancing"}],"title":"Policy"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Usage"},{"slug":"getting-started","title":"Getting started","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"simulations","title":"Running simulations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scenarios","title":"Creating policy scenarios","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Assumptions"},{"slug":"growthfactors","title":"Economic assumptions","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"water-bills","title":"Water bills projection and uprating","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Validation"},{"slug":"hbai","title":"HBAI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Policy"},{"slug":"model-baseline","title":"Model baseline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"uc-rebalancing","title":"Universal Credit rebalancing reforms","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-B2B2E6A5.js";
import * as route0 from "/build/root-IB5726YR.js";
import * as route1 from "/build/routes/$-LXLHKVOR.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-UNPC4GT3.js");</script></body></html>