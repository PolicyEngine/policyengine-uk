<!doctype html>
<html class="no-js" lang="en">
  <head><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Economic assumptions" href="../assumptions/growthfactors.html" /><link rel="prev" title="Running simulations" href="simulations.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2022.12.07 -->
        <title>Creating policy scenarios - PolicyEngine UK documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">PolicyEngine UK documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PolicyEngine UK documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Using the model</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulations.html">Running simulations</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Creating policy scenarios</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Economic assumptions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../assumptions/growthfactors.html">Economic assumptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../assumptions/water-bills.html">Water bills projection and uprating</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Validation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../validation/hbai.html">HBAI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Policy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../policy/uc-rebalancing.html">Universal Credit rebalancing reforms</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="creating-policy-scenarios">
<h1>Creating policy scenarios<a class="headerlink" href="#creating-policy-scenarios" title="Permalink to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">Scenario</span></code> class lets you define policy reforms and apply them to simulations. This guide shows you how to create everything from simple parameter changes to complex reform packages, and how to combine different policy ideas together.</p>
<section id="your-first-policy-scenario">
<h2>Your first policy scenario<a class="headerlink" href="#your-first-policy-scenario" title="Permalink to this heading">#</a></h2>
<p>Let’s start by creating a scenario that reduces the basic rate of income tax from 20% to 15%:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">policyengine_uk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scenario</span><span class="p">,</span> <span class="n">Simulation</span>

<span class="c1"># Create a scenario with one policy change</span>
<span class="n">scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.hmrc.income_tax.rates.uk[0].rate&quot;</span><span class="p">:</span> <span class="mf">0.15</span>
<span class="p">})</span>

<span class="c1"># Apply it to a simulation</span>
<span class="n">situation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;person&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">35</span><span class="p">},</span>
            <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">40_000</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;benunits&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;benunit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;households&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;household&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">]}}</span>
<span class="p">}</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">situation</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span>
<span class="n">income_tax</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;income_tax&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Income tax under 15% basic rate: £</span><span class="si">{</span><span class="n">income_tax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Under this scenario, this person would pay £2,486 instead of the current £4,486 - a reduction of £2,000 per year due to the lower tax rate.</p>
</section>
<section id="understanding-parameter-paths">
<h2>Understanding parameter paths<a class="headerlink" href="#understanding-parameter-paths" title="Permalink to this heading">#</a></h2>
<p>PolicyEngine UK organises policy parameters in a hierarchical structure. Each parameter has a path that describes where it sits in the system:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Income tax parameters</span>
<span class="s2">&quot;gov.hmrc.income_tax.rates.uk[0].rate&quot;</span>          <span class="c1"># Basic rate (20%)</span>
<span class="s2">&quot;gov.hmrc.income_tax.rates.uk[1].rate&quot;</span>          <span class="c1"># Higher rate (40%)</span>
<span class="s2">&quot;gov.hmrc.income_tax.personal_allowance&quot;</span>        <span class="c1"># Personal allowance</span>
<span class="s2">&quot;gov.hmrc.income_tax.rates.uk[0].threshold&quot;</span>     <span class="c1"># Basic rate threshold</span>

<span class="c1"># Universal Credit parameters</span>
<span class="s2">&quot;gov.dwp.universal_credit.standard_allowance.single.OVER_25&quot;</span>     <span class="c1"># Single person allowance</span>
<span class="s2">&quot;gov.dwp.universal_credit.elements.housing.max_monthly_cap&quot;</span>      <span class="c1"># Housing cost cap</span>
<span class="s2">&quot;gov.dwp.universal_credit.means_test.income_disregard&quot;</span>           <span class="c1"># Work allowance</span>

<span class="c1"># Child benefits</span>
<span class="s2">&quot;gov.hmrc.child_benefit.rates.first_child&quot;</span>      <span class="c1"># First child rate</span>
<span class="s2">&quot;gov.hmrc.child_benefit.rates.additional_child&quot;</span> <span class="c1"># Additional children rate</span>
</pre></div>
</div>
<p>You can find parameter paths by exploring the PolicyEngine web app or looking in the <code class="docutils literal notranslate"><span class="pre">parameters/</span></code> directory of the codebase.</p>
</section>
<section id="creating-comprehensive-reform-packages">
<h2>Creating comprehensive reform packages<a class="headerlink" href="#creating-comprehensive-reform-packages" title="Permalink to this heading">#</a></h2>
<p>Real policy proposals often involve multiple changes. Here’s how to create a comprehensive reform:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># A comprehensive package that increases Universal Credit support while adjusting income tax</span>
<span class="c1"># This represents the kind of coordinated policy change you might see in a budget</span>
<span class="n">welfare_reform</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="c1"># Increase UC standard allowances</span>
    <span class="s2">&quot;gov.dwp.universal_credit.standard_allowance.single.OVER_25&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="s2">&quot;gov.dwp.universal_credit.standard_allowance.single.UNDER_25&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
    <span class="s2">&quot;gov.dwp.universal_credit.standard_allowance.couple&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span>
    
    <span class="c1"># Reduce UC taper rate (less benefit withdrawn per pound earned)</span>
    <span class="s2">&quot;gov.dwp.universal_credit.means_test.reduction_rate&quot;</span><span class="p">:</span> <span class="mf">0.55</span><span class="p">,</span>
    
    <span class="c1"># Increase income tax personal allowance</span>
    <span class="s2">&quot;gov.hmrc.income_tax.personal_allowance&quot;</span><span class="p">:</span> <span class="mi">15_000</span><span class="p">,</span>
    
    <span class="c1"># Reduce basic rate slightly to help fund UC increases</span>
    <span class="s2">&quot;gov.hmrc.income_tax.rates.uk[0].rate&quot;</span><span class="p">:</span> <span class="mf">0.22</span>
<span class="p">})</span>

<span class="c1"># Test on a working family</span>
<span class="n">family_situation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span> <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">20_000</span><span class="p">}},</span>
        <span class="s2">&quot;child&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">5</span><span class="p">}}</span>
    <span class="p">},</span>
    <span class="s2">&quot;benunits&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;households&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;home&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">],</span>
            <span class="s2">&quot;housing_costs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">7200</span><span class="p">}</span>  <span class="c1"># Annual housing costs</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">reformed_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">family_situation</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">welfare_reform</span><span class="p">)</span>

<span class="c1"># Calculate the impact of this comprehensive package on the family</span>
<span class="n">uc_amount</span> <span class="o">=</span> <span class="n">reformed_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;universal_credit&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">income_tax</span> <span class="o">=</span> <span class="n">reformed_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;income_tax&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">net_income</span> <span class="o">=</span> <span class="n">reformed_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;household_net_income&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Universal Credit: £</span><span class="si">{</span><span class="n">uc_amount</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> per month&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Income tax: £</span><span class="si">{</span><span class="n">income_tax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> per year&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Monthly net income: £</span><span class="si">{</span><span class="n">net_income</span><span class="o">/</span><span class="mi">12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="combining-scenarios">
<h2>Combining scenarios<a class="headerlink" href="#combining-scenarios" title="Permalink to this heading">#</a></h2>
<p>You can combine different scenarios using the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator, which is useful for testing different combinations of policies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create separate scenarios for different policy areas</span>
<span class="n">tax_scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.hmrc.income_tax.personal_allowance&quot;</span><span class="p">:</span> <span class="mi">15_000</span><span class="p">,</span>
    <span class="s2">&quot;gov.hmrc.income_tax.rates.uk[0].rate&quot;</span><span class="p">:</span> <span class="mf">0.18</span>
<span class="p">})</span>

<span class="n">benefits_scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.dwp.universal_credit.standard_allowance.single.OVER_25&quot;</span><span class="p">:</span> <span class="mi">450</span><span class="p">,</span>
    <span class="s2">&quot;gov.dwp.universal_credit.means_test.reduction_rate&quot;</span><span class="p">:</span> <span class="mf">0.50</span>
<span class="p">})</span>

<span class="n">childcare_scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.dwp.universal_credit.elements.childcare.max_proportion&quot;</span><span class="p">:</span> <span class="mf">0.90</span>
<span class="p">})</span>

<span class="c1"># Combine them in different ways</span>
<span class="n">tax_and_benefits</span> <span class="o">=</span> <span class="n">tax_scenario</span> <span class="o">+</span> <span class="n">benefits_scenario</span>
<span class="n">full_package</span> <span class="o">=</span> <span class="n">tax_scenario</span> <span class="o">+</span> <span class="n">benefits_scenario</span> <span class="o">+</span> <span class="n">childcare_scenario</span>

<span class="c1"># Test each combination to see how different policy areas interact</span>
<span class="c1"># This shows how you can build up complex policies piece by piece</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Tax only&quot;</span><span class="p">,</span> <span class="n">tax_scenario</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Benefits only&quot;</span><span class="p">,</span> <span class="n">benefits_scenario</span><span class="p">),</span> 
                      <span class="p">(</span><span class="s2">&quot;Tax + benefits&quot;</span><span class="p">,</span> <span class="n">tax_and_benefits</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Full package&quot;</span><span class="p">,</span> <span class="n">full_package</span><span class="p">)]:</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">family_situation</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span>
    <span class="n">net_income</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;household_net_income&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: £</span><span class="si">{</span><span class="n">net_income</span><span class="o">/</span><span class="mi">12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> per month&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="defining-structural-scenarios">
<h2>Defining structural scenarios<a class="headerlink" href="#defining-structural-scenarios" title="Permalink to this heading">#</a></h2>
<p>Beyond simple parameter changes, you sometimes need scenarios that make structural modifications to how the tax-benefit system works. Let’s walk through how to create these, using examples similar to those in PolicyEngine UK’s scenarios module.</p>
<section id="creating-a-two-child-limit-repeal-scenario">
<h3>Creating a two-child limit repeal scenario<a class="headerlink" href="#creating-a-two-child-limit-repeal-scenario" title="Permalink to this heading">#</a></h3>
<p>The two-child limit restricts Universal Credit child elements to the first two children. Here’s how to build a scenario that removes this restriction:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">policyengine_uk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scenario</span>

<span class="c1"># The two-child limit is controlled by this parameter</span>
<span class="c1"># Setting it to infinity effectively removes the limit</span>
<span class="n">repeal_two_child_limit</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.dwp.universal_credit.elements.child.limit.child_count&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;year:2026:10&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>  <span class="c1"># From October 2026 onwards, no limit</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="c1"># Test this on a family with three children</span>
<span class="n">large_family</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">35</span><span class="p">},</span> <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">18_000</span><span class="p">}},</span>
        <span class="s2">&quot;child1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">12</span><span class="p">}},</span>
        <span class="s2">&quot;child2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">8</span><span class="p">}},</span>
        <span class="s2">&quot;child3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">4</span><span class="p">}}</span>  <span class="c1"># Third child - currently gets no UC support</span>
    <span class="p">},</span>
    <span class="s2">&quot;benunits&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child1&quot;</span><span class="p">,</span> <span class="s2">&quot;child2&quot;</span><span class="p">,</span> <span class="s2">&quot;child3&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;households&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;home&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child1&quot;</span><span class="p">,</span> <span class="s2">&quot;child2&quot;</span><span class="p">,</span> <span class="s2">&quot;child3&quot;</span><span class="p">],</span>
            <span class="s2">&quot;housing_costs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">10200</span><span class="p">}</span>  <span class="c1"># Annual housing costs</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Compare the impact</span>
<span class="n">baseline_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">large_family</span><span class="p">)</span>
<span class="n">reformed_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">large_family</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">repeal_two_child_limit</span><span class="p">)</span>

<span class="n">baseline_uc</span> <span class="o">=</span> <span class="n">baseline_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;universal_credit&quot;</span><span class="p">,</span> <span class="mi">2026</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">reformed_uc</span> <span class="o">=</span> <span class="n">reformed_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;universal_credit&quot;</span><span class="p">,</span> <span class="mi">2026</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">increase</span> <span class="o">=</span> <span class="n">reformed_uc</span> <span class="o">-</span> <span class="n">baseline_uc</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UC increase from third child: £</span><span class="si">{</span><span class="n">increase</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> per month&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="building-a-benefit-cap-reindexing-scenario">
<h3>Building a benefit cap reindexing scenario<a class="headerlink" href="#building-a-benefit-cap-reindexing-scenario" title="Permalink to this heading">#</a></h3>
<p>The benefit cap hasn’t risen with inflation since 2016. Here’s how to create a scenario that automatically indexes it to CPI:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">policyengine_uk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scenario</span><span class="p">,</span> <span class="n">Simulation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">policyengine_core.parameters</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>

<span class="k">def</span><span class="w"> </span><span class="nf">reindex_benefit_cap_to_cpi</span><span class="p">(</span><span class="n">simulation</span><span class="p">:</span> <span class="n">Simulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Modify simulation to index benefit cap parameters to CPI inflation&quot;&quot;&quot;</span>
    <span class="c1"># Reset the parameter system to make changes</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">tax_benefit_system</span><span class="o">.</span><span class="n">reset_parameters</span><span class="p">()</span>
    
    <span class="c1"># Find all benefit cap parameters in the system</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">tax_benefit_system</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">gov</span><span class="o">.</span><span class="n">dwp</span><span class="o">.</span><span class="n">benefit_cap</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">()</span>
    
    <span class="c1"># Filter to only the actual parameter values (leaf nodes)</span>
    <span class="n">cap_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)]</span>
    
    <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">cap_parameters</span><span class="p">:</span>
        <span class="c1"># Remove any values after 2025 (current frozen values)</span>
        <span class="n">parameter</span><span class="o">.</span><span class="n">values_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">parameter</span><span class="o">.</span><span class="n">values_list</span> 
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">instant_str</span> <span class="o">&lt;</span> <span class="s2">&quot;2026-01-01&quot;</span>
        <span class="p">]</span>
        
        <span class="c1"># Set the parameter to follow CPI uprating from 2026</span>
        <span class="n">parameter</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">uprating</span><span class="o">=</span><span class="s2">&quot;gov.benefit_uprating_cpi&quot;</span><span class="p">)</span>
    
    <span class="c1"># Reprocess the parameters to apply changes</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">tax_benefit_system</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">()</span>

<span class="c1"># Create the scenario using a simulation modifier</span>
<span class="n">reindex_benefit_cap</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">simulation_modifier</span><span class="o">=</span><span class="n">reindex_benefit_cap_to_cpi</span><span class="p">)</span>

<span class="c1"># Test on a family that might hit the benefit cap</span>
<span class="n">benefit_cap_family</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;parent1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span> <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
        <span class="s2">&quot;parent2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">28</span><span class="p">},</span> <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
        <span class="s2">&quot;child1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">6</span><span class="p">}},</span>
        <span class="s2">&quot;child2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}</span>
    <span class="p">},</span>
    <span class="s2">&quot;benunits&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;parent1&quot;</span><span class="p">,</span> <span class="s2">&quot;parent2&quot;</span><span class="p">,</span> <span class="s2">&quot;child1&quot;</span><span class="p">,</span> <span class="s2">&quot;child2&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;households&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;home&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;parent1&quot;</span><span class="p">,</span> <span class="s2">&quot;parent2&quot;</span><span class="p">,</span> <span class="s2">&quot;child1&quot;</span><span class="p">,</span> <span class="s2">&quot;child2&quot;</span><span class="p">],</span>
            <span class="s2">&quot;housing_costs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">14400</span><span class="p">}</span>  <span class="c1"># High annual housing costs</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">baseline_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">benefit_cap_family</span><span class="p">)</span>
<span class="n">reformed_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">benefit_cap_family</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">reindex_benefit_cap</span><span class="p">)</span>

<span class="c1"># Compare the benefit cap levels</span>
<span class="n">baseline_cap</span> <span class="o">=</span> <span class="n">baseline_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;benefit_cap&quot;</span><span class="p">,</span> <span class="mi">2026</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">reformed_cap</span> <span class="o">=</span> <span class="n">reformed_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;benefit_cap&quot;</span><span class="p">,</span> <span class="mi">2026</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Benefit cap - frozen: £</span><span class="si">{</span><span class="n">baseline_cap</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">/year, indexed: £</span><span class="si">{</span><span class="n">reformed_cap</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">/year&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-scenario-techniques">
<h2>Advanced scenario techniques<a class="headerlink" href="#advanced-scenario-techniques" title="Permalink to this heading">#</a></h2>
<section id="time-varying-parameters">
<h3>Time-varying parameters<a class="headerlink" href="#time-varying-parameters" title="Permalink to this heading">#</a></h3>
<p>Some reforms phase in over time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># A scenario that gradually increases the personal allowance over four years</span>
<span class="c1"># This kind of phasing helps manage fiscal costs and economic adjustment</span>
<span class="n">phased_scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.hmrc.income_tax.personal_allowance&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;2025&quot;</span><span class="p">:</span> <span class="mi">13_000</span><span class="p">,</span>
        <span class="s2">&quot;2026&quot;</span><span class="p">:</span> <span class="mi">14_000</span><span class="p">,</span>
        <span class="s2">&quot;2027&quot;</span><span class="p">:</span> <span class="mi">15_000</span><span class="p">,</span>
        <span class="s2">&quot;2028&quot;</span><span class="p">:</span> <span class="mi">16_000</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="c1"># Test this on a middle-income earner to see the progressive impact</span>
<span class="n">situation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;person&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span> <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">35_000</span><span class="p">}}},</span>
    <span class="s2">&quot;benunits&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;benunit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;households&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;household&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">]}}</span>
<span class="p">}</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">situation</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">phased_scenario</span><span class="p">)</span>

<span class="c1"># Show how the tax burden decreases year by year</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">2026</span><span class="p">,</span> <span class="mi">2027</span><span class="p">,</span> <span class="mi">2028</span><span class="p">]:</span>
    <span class="n">allowance</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;income_tax_personal_allowance&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">tax</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;income_tax&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">: Personal allowance £</span><span class="si">{</span><span class="n">allowance</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">, annual tax £</span><span class="si">{</span><span class="n">tax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="creating-complex-scenarios-with-simulation-modifiers">
<h3>Creating complex scenarios with simulation modifiers<a class="headerlink" href="#creating-complex-scenarios-with-simulation-modifiers" title="Permalink to this heading">#</a></h3>
<p>Some policy changes require modifying individual records rather than just changing parameters. Here’s how to build a scenario that phases out PIP payments for some claimants over time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">policyengine_uk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scenario</span><span class="p">,</span> <span class="n">Simulation</span>

<span class="k">def</span><span class="w"> </span><span class="nf">phase_out_pip_gradually</span><span class="p">(</span><span class="n">sim</span><span class="p">:</span> <span class="n">Simulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gradually phase out PIP for a proportion of claimants between 2025-2029&quot;&quot;&quot;</span>
    <span class="c1"># Set random seed for reproducible results</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    
    <span class="c1"># Create random assignment for each person</span>
    <span class="n">pip_phase_out_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;person_id&quot;</span><span class="p">)))</span>
    
    <span class="c1"># Define the phase-out period</span>
    <span class="n">start_year</span> <span class="o">=</span> <span class="mi">2025</span>
    <span class="n">end_year</span> <span class="o">=</span> <span class="mi">2029</span>
    
    <span class="c1"># Apply phase-out year by year</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Get current PIP payments</span>
        <span class="n">current_pip</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
        
        <span class="c1"># Calculate how far through the phase-out we are</span>
        <span class="n">phase_progress</span> <span class="o">=</span> <span class="p">(</span><span class="n">year</span> <span class="o">-</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">end_year</span> <span class="o">-</span> <span class="n">start_year</span><span class="p">)</span>
        
        <span class="c1"># 25% of claimants lose PIP, gradually over the period</span>
        <span class="c1"># In year 1, nobody loses it; by final year, 25% have lost it completely</span>
        <span class="n">affected_threshold</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">phase_progress</span>
        
        <span class="c1"># Set PIP to zero for affected claimants</span>
        <span class="n">current_pip</span><span class="p">[</span><span class="n">pip_phase_out_seed</span> <span class="o">&lt;</span> <span class="n">affected_threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># Apply the modified values back to the simulation</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">current_pip</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">sim</span>

<span class="c1"># Create the scenario</span>
<span class="n">pip_phase_out</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">simulation_modifier</span><span class="o">=</span><span class="n">phase_out_pip_gradually</span><span class="p">)</span>

<span class="c1"># Test on someone who receives PIP</span>
<span class="n">pip_recipient</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;person&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">45</span><span class="p">},</span>
            <span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">150</span><span class="p">},</span>  <span class="c1"># Weekly PIP payment</span>
            <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">8_000</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;benunits&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;benunit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;households&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;household&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">]}}</span>
<span class="p">}</span>

<span class="c1"># Compare baseline and phase-out scenarios</span>
<span class="n">baseline_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">pip_recipient</span><span class="p">)</span>
<span class="n">reformed_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">pip_recipient</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">pip_phase_out</span><span class="p">)</span>

<span class="c1"># Show how PIP changes over the phase-out period</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">2027</span><span class="p">,</span> <span class="mi">2029</span><span class="p">]:</span>
    <span class="n">baseline_pip</span> <span class="o">=</span> <span class="n">baseline_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">reformed_pip</span> <span class="o">=</span> <span class="n">reformed_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">: Baseline £</span><span class="si">{</span><span class="n">baseline_pip</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">/week, with phase-out £</span><span class="si">{</span><span class="n">reformed_pip</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">/week&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="building-universal-credit-scenarios-with-dynamic-changes">
<h3>Building Universal Credit scenarios with dynamic changes<a class="headerlink" href="#building-universal-credit-scenarios-with-dynamic-changes" title="Permalink to this heading">#</a></h3>
<p>Some scenarios need to make changes that depend on the simulation’s own data. Here’s how to create a UC scenario that adjusts payments based on claimant characteristics:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">policyengine_uk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scenario</span><span class="p">,</span> <span class="n">Microsimulation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">modify_uc_for_new_claimants</span><span class="p">(</span><span class="n">sim</span><span class="p">:</span> <span class="n">Microsimulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce health elements for new UC claimants while increasing standard allowances&quot;&quot;&quot;</span>
    <span class="c1"># Access the parameter system to check if reforms are active</span>
    <span class="n">rebalancing_params</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">tax_benefit_system</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">gov</span><span class="o">.</span><span class="n">dwp</span><span class="o">.</span><span class="n">universal_credit</span><span class="o">.</span><span class="n">rebalancing</span>
    
    <span class="c1"># Create random assignment to simulate new vs existing claimants</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">uc_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;benunit_id&quot;</span><span class="p">)))</span>
    
    <span class="c1"># Proportion of claimants who are &quot;new&quot; each year (based on real data)</span>
    <span class="n">new_claimant_rates</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">2025</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span>  <span class="c1"># No change in 2025</span>
        <span class="mi">2026</span><span class="p">:</span> <span class="mf">0.11</span><span class="p">,</span>  <span class="c1"># 11% are new claimants</span>
        <span class="mi">2027</span><span class="p">:</span> <span class="mf">0.13</span><span class="p">,</span>
        <span class="mi">2028</span><span class="p">:</span> <span class="mf">0.16</span><span class="p">,</span>
        <span class="mi">2029</span><span class="p">:</span> <span class="mf">0.22</span>
    <span class="p">}</span>
    
    <span class="c1"># Apply changes year by year</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2026</span><span class="p">,</span> <span class="mi">2030</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rebalancing_params</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
            <span class="k">continue</span>  <span class="c1"># Skip if reforms aren&#39;t active this year</span>
            
        <span class="c1"># Identify new claimants</span>
        <span class="n">is_new_claimant</span> <span class="o">=</span> <span class="n">uc_seed</span> <span class="o">&lt;</span> <span class="n">new_claimant_rates</span><span class="p">[</span><span class="n">year</span><span class="p">]</span>
        
        <span class="c1"># Modify health element for new claimants</span>
        <span class="n">current_health_element</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;uc_LCWRA_element&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
        <span class="n">new_health_amount</span> <span class="o">=</span> <span class="n">rebalancing_params</span><span class="o">.</span><span class="n">new_claimant_health_element</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span>
        
        <span class="c1"># Set new amount for new claimants who get health element</span>
        <span class="n">current_health_element</span><span class="p">[</span>
            <span class="p">(</span><span class="n">current_health_element</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">is_new_claimant</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">new_health_amount</span>
        
        <span class="n">sim</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="s2">&quot;uc_LCWRA_element&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">current_health_element</span><span class="p">)</span>
        
        <span class="c1"># Increase standard allowances for everyone</span>
        <span class="n">uplift_rate</span> <span class="o">=</span> <span class="n">rebalancing_params</span><span class="o">.</span><span class="n">standard_allowance_uplift</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="n">previous_allowance</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;uc_standard_allowance&quot;</span><span class="p">,</span> <span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_allowance</span> <span class="o">=</span> <span class="n">previous_allowance</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">uplift_rate</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="s2">&quot;uc_standard_allowance&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">new_allowance</span><span class="p">)</span>

<span class="c1"># Create the UC rebalancing scenario</span>
<span class="n">uc_rebalancing</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">simulation_modifier</span><span class="o">=</span><span class="n">modify_uc_for_new_claimants</span><span class="p">)</span>

<span class="c1"># This scenario needs the rebalancing parameters to be active</span>
<span class="n">uc_rebalancing_active</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.dwp.universal_credit.rebalancing.active&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">})</span> <span class="o">+</span> <span class="n">uc_rebalancing</span>

<span class="c1"># Test on a typical UC claimant</span>
<span class="n">uc_claimant</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;person&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">35</span><span class="p">},</span>
            <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">8_000</span><span class="p">},</span>
            <span class="s2">&quot;uc_LCWRA_element&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">390</span><span class="p">}</span>  <span class="c1"># Monthly health element</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;benunits&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;benunit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;households&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;home&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">],</span>
            <span class="s2">&quot;housing_costs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2026</span><span class="p">:</span> <span class="mi">7200</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">baseline_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">uc_claimant</span><span class="p">)</span>
<span class="n">reformed_sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">uc_claimant</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">uc_rebalancing_active</span><span class="p">)</span>

<span class="c1"># Compare UC components</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2026</span><span class="p">,</span> <span class="mi">2028</span><span class="p">]:</span>
    <span class="n">baseline_uc</span> <span class="o">=</span> <span class="n">baseline_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;universal_credit&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">reformed_uc</span> <span class="o">=</span> <span class="n">reformed_sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;universal_credit&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">: Baseline UC £</span><span class="si">{</span><span class="n">baseline_uc</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">/month, reformed £</span><span class="si">{</span><span class="n">reformed_uc</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">/month&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="analysing-scenarios-at-population-level">
<h2>Analysing scenarios at population level<a class="headerlink" href="#analysing-scenarios-at-population-level" title="Permalink to this heading">#</a></h2>
<p>Use microsimulation to understand the broader impact of your scenarios:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">policyengine_uk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Microsimulation</span>

<span class="c1"># Create a major scenario package combining tax cuts and benefit increases</span>
<span class="c1"># This represents a significant fiscal intervention</span>
<span class="n">major_scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.hmrc.income_tax.rates.uk[0].rate&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>          <span class="c1"># Cut basic rate from 20% to 15%</span>
    <span class="s2">&quot;gov.hmrc.income_tax.personal_allowance&quot;</span><span class="p">:</span> <span class="mi">16_000</span><span class="p">,</span>       <span class="c1"># Raise allowance significantly</span>
    <span class="s2">&quot;gov.dwp.universal_credit.standard_allowance.single.OVER_25&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span>  <span class="c1"># Increase UC by £100/month</span>
    <span class="s2">&quot;gov.dwp.universal_credit.means_test.reduction_rate&quot;</span><span class="p">:</span> <span class="mf">0.45</span>  <span class="c1"># Reduce taper from 55% to 45%</span>
<span class="p">})</span>

<span class="c1"># Compare baseline and reform</span>
<span class="n">baseline</span> <span class="o">=</span> <span class="n">Microsimulation</span><span class="p">(</span>
    <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;hf://policyengine/policyengine-uk-data/enhanced_frs_2022_23.h5&quot;</span>
<span class="p">)</span>
<span class="n">reformed</span> <span class="o">=</span> <span class="n">Microsimulation</span><span class="p">(</span>
    <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;hf://policyengine/policyengine-uk-data/enhanced_frs_2022_23.h5&quot;</span><span class="p">,</span>
    <span class="n">scenario</span><span class="o">=</span><span class="n">major_scenario</span>
<span class="p">)</span>

<span class="c1"># Calculate the fiscal impact of this major intervention</span>
<span class="c1"># Tax cuts reduce revenue, benefit increases raise spending</span>
<span class="n">baseline_revenue</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;income_tax&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e9</span>
<span class="n">reformed_revenue</span> <span class="o">=</span> <span class="n">reformed</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;income_tax&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e9</span>
<span class="n">tax_cost</span> <span class="o">=</span> <span class="n">baseline_revenue</span> <span class="o">-</span> <span class="n">reformed_revenue</span>

<span class="n">baseline_uc</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;universal_credit&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e9</span>
<span class="n">reformed_uc</span> <span class="o">=</span> <span class="n">reformed</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;universal_credit&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e9</span>
<span class="n">uc_cost</span> <span class="o">=</span> <span class="n">reformed_uc</span> <span class="o">-</span> <span class="n">baseline_uc</span>

<span class="n">total_cost</span> <span class="o">=</span> <span class="n">tax_cost</span> <span class="o">+</span> <span class="n">uc_cost</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Income tax revenue loss: £</span><span class="si">{</span><span class="n">tax_cost</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">bn&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UC spending increase: £</span><span class="si">{</span><span class="n">uc_cost</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">bn&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total fiscal cost: £</span><span class="si">{</span><span class="n">total_cost</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">bn&quot;</span><span class="p">)</span>

<span class="c1"># Calculate distributional impact</span>
<span class="n">baseline_poverty</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;in_poverty&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">reformed_poverty</span> <span class="o">=</span> <span class="n">reformed</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;in_poverty&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">poverty_reduction</span> <span class="o">=</span> <span class="n">baseline_poverty</span> <span class="o">-</span> <span class="n">reformed_poverty</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Poverty rate reduction: </span><span class="si">{</span><span class="n">poverty_reduction</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="testing-scenarios-step-by-step">
<h2>Testing scenarios step by step<a class="headerlink" href="#testing-scenarios-step-by-step" title="Permalink to this heading">#</a></h2>
<p>When building complex scenarios, test each component separately:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build up a complex scenario incrementally to understand each component&#39;s impact</span>
<span class="c1"># Starting with an empty scenario as our baseline</span>
<span class="n">base_scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{})</span>

<span class="c1"># Add income tax changes</span>
<span class="n">with_tax_changes</span> <span class="o">=</span> <span class="n">base_scenario</span> <span class="o">+</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.hmrc.income_tax.rates.uk[0].rate&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span>
    <span class="s2">&quot;gov.hmrc.income_tax.personal_allowance&quot;</span><span class="p">:</span> <span class="mi">14_000</span>
<span class="p">})</span>

<span class="c1"># Add UC changes</span>
<span class="n">with_uc_changes</span> <span class="o">=</span> <span class="n">with_tax_changes</span> <span class="o">+</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.dwp.universal_credit.standard_allowance.single.OVER_25&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="s2">&quot;gov.dwp.universal_credit.means_test.reduction_rate&quot;</span><span class="p">:</span> <span class="mf">0.50</span>
<span class="p">})</span>

<span class="c1"># Add child benefit changes</span>
<span class="n">full_scenario</span> <span class="o">=</span> <span class="n">with_uc_changes</span> <span class="o">+</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">parameter_changes</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;gov.hmrc.child_benefit.rates.first_child&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s2">&quot;gov.hmrc.child_benefit.rates.additional_child&quot;</span><span class="p">:</span> <span class="mi">18</span>
<span class="p">})</span>

<span class="c1"># Test the impact of each addition</span>
<span class="n">test_situation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span> <span class="s2">&quot;employment_income&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">25_000</span><span class="p">}},</span>
        <span class="s2">&quot;child&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">6</span><span class="p">}}</span>
    <span class="p">},</span>
    <span class="s2">&quot;benunits&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;households&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;home&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">],</span> <span class="s2">&quot;housing_costs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">2025</span><span class="p">:</span> <span class="mi">8400</span><span class="p">}}}</span>  <span class="c1"># Annual housing costs</span>
<span class="p">}</span>

<span class="c1"># Test each incremental addition to see cumulative effects</span>
<span class="n">scenarios</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Baseline&quot;</span><span class="p">,</span> <span class="n">base_scenario</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;With tax changes&quot;</span><span class="p">,</span> <span class="n">with_tax_changes</span><span class="p">),</span>
             <span class="p">(</span><span class="s2">&quot;With UC changes&quot;</span><span class="p">,</span> <span class="n">with_uc_changes</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Full package&quot;</span><span class="p">,</span> <span class="n">full_scenario</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="p">:</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">situation</span><span class="o">=</span><span class="n">test_situation</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span>
    <span class="n">net_income</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;household_net_income&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: £</span><span class="si">{</span><span class="n">net_income</span><span class="o">/</span><span class="mi">12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> per month&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="practical-tips-for-scenario-design">
<h2>Practical tips for scenario design<a class="headerlink" href="#practical-tips-for-scenario-design" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Start simple and build complexity gradually</p></li>
<li><p>Test scenarios on multiple household types to understand different impacts</p></li>
<li><p>Use meaningful parameter names and document your choices</p></li>
<li><p>Combine related changes logically (tax reforms with tax reforms, benefit changes with benefit changes)</p></li>
<li><p>Always check the fiscal impact of major reforms</p></li>
<li><p>Consider unintended interactions between different policy areas</p></li>
</ul>
<p>These techniques let you model complex policy changes that go beyond simple parameter adjustments. Simulation modifiers give you complete control over how the tax-benefit system works, allowing you to implement everything from gradual phase-outs to dynamic eligibility changes. The key is to understand the underlying data structures and use them thoughtfully to represent real policy proposals.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./usage"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../assumptions/growthfactors.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Economic assumptions</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="simulations.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Running simulations</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Creating policy scenarios</a><ul>
<li><a class="reference internal" href="#your-first-policy-scenario">Your first policy scenario</a></li>
<li><a class="reference internal" href="#understanding-parameter-paths">Understanding parameter paths</a></li>
<li><a class="reference internal" href="#creating-comprehensive-reform-packages">Creating comprehensive reform packages</a></li>
<li><a class="reference internal" href="#combining-scenarios">Combining scenarios</a></li>
<li><a class="reference internal" href="#defining-structural-scenarios">Defining structural scenarios</a><ul>
<li><a class="reference internal" href="#creating-a-two-child-limit-repeal-scenario">Creating a two-child limit repeal scenario</a></li>
<li><a class="reference internal" href="#building-a-benefit-cap-reindexing-scenario">Building a benefit cap reindexing scenario</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-scenario-techniques">Advanced scenario techniques</a><ul>
<li><a class="reference internal" href="#time-varying-parameters">Time-varying parameters</a></li>
<li><a class="reference internal" href="#creating-complex-scenarios-with-simulation-modifiers">Creating complex scenarios with simulation modifiers</a></li>
<li><a class="reference internal" href="#building-universal-credit-scenarios-with-dynamic-changes">Building Universal Credit scenarios with dynamic changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#analysing-scenarios-at-population-level">Analysing scenarios at population level</a></li>
<li><a class="reference internal" href="#testing-scenarios-step-by-step">Testing scenarios step by step</a></li>
<li><a class="reference internal" href="#practical-tips-for-scenario-design">Practical tips for scenario design</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>